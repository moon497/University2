<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="EBbs">

<select id="getBbsCount" parameterType="E_BBS_DTO" resultType="java.lang.Integer">
		SELECT NVL(COUNT(*), 0) AS CNT
		FROM ECLASS_NOTICE_BBS
		WHERE DEL=0
</select>

<select id="getEBbsList" resultType="E_BBS_DTO" parameterType="kh.com.util.Pagination">	
	SELECT 
         ECLASS_NOTICE_BBS_SEQ, USER_ID, TITLE , CONTENT , READCOUNT,
		 FILENAME,ORG_FILENAME, WDATE, SUB_SEQ, DEL
      FROM (
      		SELECT  ECLASS_NOTICE_BBS_SEQ, USER_ID, TITLE , CONTENT , READCOUNT,
		   			FILENAME,ORG_FILENAME, WDATE, SUB_SEQ, DEL, 
		   			ROW_NUMBER() OVER (ORDER BY ECLASS_NOTICE_BBS_SEQ desc) R
            FROM ECLASS_NOTICE_BBS
            WHERE DEL = 0
      )
      WHERE R BETWEEN #{startArticle} and #{endArticle}
</select>
	
<insert id="uploadPds" parameterType="E_BBS_DTO" useGeneratedKeys="false">
	INSERT INTO ECLASS_NOTICE_BBS
	(ECLASS_NOTICE_BBS_SEQ, USER_ID, TITLE , CONTENT , READCOUNT,
	 FILENAME,WDATE, SUB_SEQ, DEL,ORG_FILENAME)
	VALUES(ECLASS_NOTICE_BBS_SEQ.NEXTVAL, #{user_id}, #{title},#{content},0,#{filename},
		   SYSDATE, 0, 0,#{org_filename})
</insert>

<!-- 디테일 -->
<select id="getEbbs" resultType="E_BBS_DTO" parameterType="java.lang.Integer">
	SELECT ECLASS_NOTICE_BBS_SEQ, USER_ID, TITLE , CONTENT , READCOUNT,
		   FILENAME,ORG_FILENAME, WDATE, SUB_SEQ, DEL
	FROM ECLASS_NOTICE_BBS 
	WHERE ECLASS_NOTICE_BBS_SEQ=#{eclass_notice_bbs_seq}
</select>

<update id="addReadcount" parameterType="java.lang.Integer">
		UPDATE ECLASS_NOTICE_BBS
		SET READCOUNT=READCOUNT+1
		WHERE ECLASS_NOTICE_BBS_SEQ=#{eclass_notice_bbs_seq}
</update>

<update id="updateEBbs" parameterType="kh.com.model.E_BbsDto" >
	UPDATE ECLASS_NOTICE_BBS 
	SET TITLE=#{title}, 
		CONTENT=#{content},
		FILENAME=#{filename},
		ORG_FILENAME=#{org_filename}
	WHERE ECLASS_NOTICE_BBS_SEQ=#{eclass_notice_bbs_seq}
</update>





</mapper>
