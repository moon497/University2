<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
  
<mapper namespace="Enrolment">
	
<insert id="addSubject" parameterType="SubjectDto" useGeneratedKeys="false">
	INSERT INTO SUBJECT (SUB_SEQ, SUB_CATEGORY, MAJOR_NUMBER, SUB_GRADE, SUB_SEMESTER,
						SUB_NAME, PROFESSOR_ID, PROFESSOR_NAME, SUB_INFO, SUB_ROOM, SUB_WEEK,
						SUB_S_CLASS, SUB_E_CLASS, SUB_MAX_STUDENT, SUB_NOW_STUDENT, SUB_POINT,
						SUB_REF, SUB_PARENT)
	VALUES (SUB_SEQ.NEXTVAL , #{sub_category}, #{major_number}, #{sub_grade}, #{sub_semester},
			#{sub_name}, #{professor_id}, #{professor_name}, #{sub_info}, #{sub_room}, #{sub_week},
			#{sub_s_class}, #{sub_e_class}, #{sub_max_student}, #{sub_now_student}, #{sub_point},
			(SELECT NVL(MAX(SUB_REF),0)+1 FROM SUBJECT), 0)
</insert>

<select id="getSublist" parameterType="java.lang.String" resultType="SubjectDto">
	SELECT SUB_SEQ, SUB_CATEGORY, MAJOR_NUMBER, SUB_GRADE, SUB_SEMESTER,SUB_NAME,
		   PROFESSOR_ID, PROFESSOR_NAME, SUB_INFO, SUB_ROOM, SUB_WEEK, SUB_S_CLASS,
		   SUB_E_CLASS, SUB_MAX_STUDENT, SUB_NOW_STUDENT, SUB_POINT, SUB_REF, SUB_PARENT
	FROM SUBJECT
	WHERE PROFESSOR_ID=#{id}
	ORDER BY SUB_REF ASC, SUB_MAX_STUDENT DESC
</select>

<select id="getReg" parameterType="java.lang.Integer" resultType="SubjectDto">
	SELECT SUB_SEQ, SUB_CATEGORY, MAJOR_NUMBER, SUB_GRADE, SUB_SEMESTER,SUB_NAME,
		   PROFESSOR_ID, PROFESSOR_NAME, SUB_INFO, SUB_ROOM, SUB_WEEK, SUB_S_CLASS,
		   SUB_E_CLASS, SUB_MAX_STUDENT, SUB_NOW_STUDENT, SUB_POINT, SUB_REF, SUB_PARENT
	FROM SUBJECT
	WHERE SUB_SEQ=#{seq}
</select>

<insert id="addClassTime" parameterType="SubjectDto" useGeneratedKeys="false">
	INSERT INTO SUBJECT (SUB_SEQ, SUB_CATEGORY, MAJOR_NUMBER, SUB_GRADE, SUB_SEMESTER,
						SUB_NAME, PROFESSOR_ID, PROFESSOR_NAME, SUB_INFO, SUB_ROOM, SUB_WEEK,
						SUB_S_CLASS, SUB_E_CLASS, SUB_MAX_STUDENT, SUB_NOW_STUDENT, SUB_POINT,
						SUB_REF, SUB_PARENT)
	VALUES(SUB_SEQ.NEXTVAL, #{sub_category}, #{major_number}, #{sub_grade}, #{sub_semester},
			#{sub_name}, #{professor_id}, #{professor_name}, #{sub_info}, #{sub_room}, #{sub_week},
			#{sub_s_class}, #{sub_e_class}, 0, 0, #{sub_point},
			(SELECT SUB_REF FROM SUBJECT WHERE SUB_SEQ=#{sub_seq}), #{sub_parent})						
</insert>

<delete id="deleteReg" parameterType="java.lang.Integer">
	DELETE FROM SUBJECT
	WHERE SUB_SEQ=#{seq}
</delete>
	 
<select id="getEnrollist" parameterType="java.lang.String" resultType="SubjectDto">
	SELECT *
	FROM SUBJECT
	WHERE MAJOR_NUMBER=#{major}
	ORDER BY SUB_REF ASC, SUB_MAX_STUDENT DESC
</select>	 

<!-- 문성환 -->
<select id="getEnrollListFromUser" parameterType="String" resultType="SubjectDto">
	SELECT S.SUB_SEQ, S.SUB_CATEGORY, S.MAJOR_NUMBER, S.SUB_GRADE, S.SUB_SEMESTER,
						S.SUB_NAME, S.PROFESSOR_ID, S.PROFESSOR_NAME, S.SUB_INFO, S.SUB_ROOM, S.SUB_WEEK,
						S.SUB_S_CLASS, S.SUB_E_CLASS, S.SUB_MAX_STUDENT, S.SUB_NOW_STUDENT, S.SUB_POINT,
						S.SUB_REF, S.SUB_PARENT
	FROM ASSESSMENT A, SUBJECT S
	WHERE A.SUB_SEQ_NUM = S.SUB_SEQ
	AND A.STUDENT_ID=#{user_id}
</select>

<delete id="deleteEnroll" parameterType="java.lang.Integer">
	DELETE FROM ASSESSMENT
	WHERE SUB_SEQ_NUM=#{sub_seq}
</delete>

</mapper>